---
import { getSimilarPosts } from "@/lib/utils/content";
import { cn } from "@/lib/utils/cn";

interface Props {
  currentSlug: string;
  limit?: number;
}

const { currentSlug, limit = 3 } = Astro.props;
const similarPosts = await getSimilarPosts(currentSlug, limit);
---

{
  similarPosts.length > 0 && (
    <div class="border-b border-container">
      <div class="main-container">
        <div class="border-b border-container px-6 py-4">
          <h2 class="text-lg font-medium">相关推荐</h2>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3">
          {similarPosts.map(({ post }, index) => (
            <a
              href={`/post/${post.id}`}
              class={cn([
                "group @container",
                "border-container color-transition-card-btn",
                "flex flex-col gap-2 px-6 py-6 @lg:px-8 @lg:py-8",
                index < similarPosts.length - 1 &&
                  "border-b md:border-r md:border-b-0",
              ])}
            >
              <h3 class="leading-snug font-medium transition-colors group-hover:text-accent-foreground">
                {post.data.title}
              </h3>
              {post.data.tags.length > 0 && (
                <div class="mt-auto flex items-center pt-2 text-sm text-comment select-none">
                  <span class="mr-1 i-lucide-hash size-4" />
                  <span class="space-x-0.5">
                    {post.data.tags.slice(0, 3).map((tag, tagIndex) => (
                      <>
                        {tagIndex !== 0 && <span>|</span>}
                        <span>{tag}</span>
                      </>
                    ))}
                  </span>
                </div>
              )}
            </a>
          ))}
        </div>
      </div>
    </div>
  )
}
